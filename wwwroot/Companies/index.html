<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公司基本資料</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

</head>
<body>

    <div class="container">
        <h2>公司基本資料</h2>       
        <table id="CompList" class="table table-striped border border-2 border-dark rounded table-hover mt-3">
            <thead>
                <tr class="table-info border border-bottom border-primary border-1">
                    <th>公司代碼</th>
                    <th>公司名稱</th>
                    <th>公司連絡電話</th>
                    <th>行業別</th>
                    <th>董事長</th>
                    <th>公司網址</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>


        <!-- Modal -->
        <div class="modal fade" id="dataManageModal" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5"></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                    </div>
                    <div class="modal-footer">                       
                    </div>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                crossorigin="anonymous"></script>

        <script>

            let modalForm = `
                        <form id="dataManageModalForm">
                            <div class="row">
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="CompanyID" class="form-label">公司代碼</label>
                                        <input type="text" class="form-control" id="CompanyID" name="CompanyID">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="CompanyName" class="form-label">公司名稱</label>
                                        <input type="text" class="form-control" id="CompanyName" name="CompanyName">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="CompanyPhone" class="form-label">公司連絡電話</label>
                                        <input type="text" class="form-control" id="CompanyPhone" name="CompanyPhone">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="CompanyAddress" class="form-label">公司地址</label>
                                        <input type="text" class="form-control" id="CompanyAddress" name="CompanyAddress">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="Industry" class="form-label">行業別</label>
                                        <input type="text" class="form-control" id="Industry" name="Industry">
                                        <span class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="Spokesperson" class="form-label">發言人</label>
                                        <input type="text" class="form-control" id="Spokesperson" name="Spokesperson">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="SpokespersonTitle" class="form-label">發言人職稱</label>
                                        <input type="text" class="form-control" id="SpokespersonTitle" name="SpokespersonTitle">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="SpokespersonPhone" class="form-label">發言人電話</label>
                                        <input type="text" class="form-control"id="SpokespersonPhone" name="SpokespersonPhone">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="SpokespersonEmail" class="form-label">發言人電子信箱</label>
                                        <input type="text" class="form-control" id="SpokespersonEmail" name="SpokespersonEmail">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="DeputySpokesperson" class="form-label">代理發言人</label>
                                        <input type="text" class="form-control" id="DeputySpokesperson" name="DeputySpokesperson">
                                        <span class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="mb-3">
                                        <label for="Chairman" class="form-label">董事長</label>
                                        <input type="text" class="form-control" id="Chairman" name="Chairman">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="Website" class="form-label">公司網址</label>
                                        <input type="text" class="form-control" id="Website" name="Website">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="AccountingFirmName" class="form-label">會計事務所</label>
                                        <input type="text" class="form-control" id="AccountingFirmName" name="AccountingFirmName">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="CompanyReportingDate" class="form-label">出表日期</label>
                                        <input type="text" class="form-control" id="CompanyReportingDate" name="CompanyReportingDate">
                                        <span class="text-danger"></span>
                                    </div>
                                   <div class="mb-3">
                                        <label for="FinancialYear" class="form-label">財務年度</label>
                                        <input type="text" class="form-control" id="FinancialYear" name="FinancialYear">
                                        <span class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                         <label for="Quarter" class="form-label">季度</label>
                                         <input type="text" class="form-control" id="Quarter" name="Quarter">
                                         <span class="text-danger"></span>
                                     </div>

                                </div>
                            </div>
                            <div class="mb-3">
                                 <label for="Description" class="form-label">公司簡介</label>
                                 <textarea class="form-control" id="Description" name="Description" rows="3"></textarea>
                                 <span class="text-danger"></span>
                             </div>
                        </form>
                        `;

            const dataManageModalEl = document.getElementById('dataManageModal');

            dataManageModalEl.addEventListener('show.bs.modal', event => {                
                $('#dataManageModal .modal-body').html(modalForm);
            })

            const dataManageModal = new bootstrap.Modal(dataManageModalEl)

            //檢視公司基本資料
            function GetCompDetail(id) {
                $.ajax({
                    type: "Get",
                    url: `http://localhost:5014/apiCompanies/${id}`,
                    success: function (data) {
                        console.log(data);

                        //調整日期格式測試，測試成功
                        let companyReportingDateFormatted = new Date(data.companyReportingDate).toLocaleDateString('zh-TW', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        });

                        $('#dataManageModal .modal-header>h1').text('公司基本資料');
                        $('#dataManageModal .modal-body').html(modalForm);                        
                        $('#CompanyID').val(data.companyID);
                        $('#CompanyName').val(data.companyName);
                        $('#CompanyPhone').val(data.companyPhone);
                        $('#CompanyAddress').val(data.companyAddress);
                        $('#Industry').val(data.industry);
                        $('#Spokesperson').val(data.spokesperson);
                        $('#SpokespersonTitle').val(data.spokespersonTitle);
                        $('#SpokespersonPhone').val(data.spokespersonPhone);
                        $('#SpokespersonEmail').val(data.spokespersonEmail);
                        $('#DeputySpokesperson').val(data.seputySpokesperson);
                        $('#Chairman').val(data.chairman);
                        $('#Description').val(data.description);
                        $('#Website').val(data.website);
                        $('#AccountingFirmName').val(data.accountingFirmName);
                        $('#CompanyReportingDate').val(companyReportingDateFormatted);
                        $('#FinancialYear').val(data.financialYear);
                        $('#Quarter').val(data.quarter);
                    },

                    error: function (rsep) {
                        console.log(rsep);
                    }
                });
            }

            getCompList();
            //取出所有公司資料
            function getCompList() {
                $.ajax({
                    type: "Get",
                    url: "http://localhost:5014/apiCompanies",
                    success: function (data) {
                        console.log(data);
                        $('#CompList tbody').empty();

                        let trItem = ""
                        for (let item of data) {

                            trItem = `
                                                                 <tr>
                                                                      <td>${item.companyID}</td>
                                                                      <td>${item.companyName}</td>
                                                                      <td>${item.companyPhone}</td>
                                                                      <td>${item.industry}</td>
                                                                      <td>${item.chairman}</td>
                                                                      <td>${item.website}</td>
                                                                      <td>
                                                                         <button class="btn btn-secondary btn-outline-dark buttonShadow" data-bs-toggle="modal" data-bs-target="#dataManageModal" onclick="GetCompDetail('${item.companyID}')">檢視</button>
                                                                      </td>
                                                                 </tr>
                                                                 `
                            $('#CompList tbody').append(trItem);
                        }
                    },
                    error: function (resp) {
                        console.log(rsep);
                    }
                });
            }

        </script>
    </div>
</body>
</html>